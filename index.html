<html>
<head>
	<title>My SPA</title>

	<script 
		src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.js"
	></script>

	<script 
		src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.2.1/mustache.js"
	></script>

	<script src="/xregexp-all.js"></script>

	<script src="/spa.js"></script>

	<script type="text/javascript">
		spa.content.template = spa.templatePath('/template.html')

		/*
			routes
		*/

		spa.routeAdd({
			url: '^$',
			title: 'home',
			template: spa.templatePath('/home.html'),
			context: {}
		});

		spa.routeAdd({
			url: '^about$',
			title: 'About',
			template: spa.templatePath('/about.html'),
			context: {}
		});

		spa.routeAdd({
			url: '^[0-9]+$',
			title: 'Number',
			template: 'Number match!',
		});

		spa.routeAdd({
			url: '^(?<name>[a-z]+)/(?<id> [0-9]+)',
			title: 'User Info',
			template: spa.templatePath('/user.html'),
			action: function(){
				this.context = this.res;
				this.renderTemplate();
			}
		});

		//catch all route
		// spa.routeAdd({
		// 	ulr: '^server/(?<fileName>.+)',
		// 	action: function (page, callback) {
		// 		spa.cache.$main.load(window.location.pathname);
		// 	}
		// });

		/*
			components
		*/

		spa.addComponent({
			name: 'clock',
			template: '<div id="spa-clock-text">The Time Is:</div><div id="spa-clock-time">{{hour}}:{{minute}}:{{second}}</div>',
			init: function(){
				this.setInterval.refresh = window.setInterval(function(component){
					var time = new Date();
					
					component.renderTemplate({
						hour: time.getHours()%12,
						minute: time.getMinutes(),
						second: time.getSeconds()
					});
				}, 500, this);
			}
		});

		spa.addComponent({
			name: 'reddit',
			template: spa.templatePath('/reddit.html'),
			init: function(){
				var component = this;
				$.get('https://www.reddit.com/.json', function (data) {
					component.renderTemplate({
						posts: data.data.children
					});
			    });
			}
		});

	</script>
</head>
<body>
	<div id="spa-loader-holder">
		<center>
			<h1>Loading...</h1>
		</center>
	</div>
	<div id="spa-content" style="display:none;">
	</div>
</body>
</html>
