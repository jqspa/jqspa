<html>
<head>
	<title>My SPA</title>

	<script 
		src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.js"
	></script>

	<script 
		src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.2.1/mustache.js"
	></script>

	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/xregexp/3.1.1/xregexp-all.min.js"
	></script>

	<script src="spa.min.js"></script>

	<script type="text/javascript">

		spa.Shell.add({
			name: 'index',
			template: spa.includeTemplate('/shells/template.html')
		});

		/*
			routes
		*/

		spa.Page.add({
			uri: '^$',
			title: 'home',
			template: spa.includeTemplate('/pages/home.html'),
			context: {}
		});

		spa.Page.add({
			uri: '^about$',
			title: 'About',
			template: spa.includeTemplate('/pages/about.html'),
			context: {}
		});

		spa.Page.add({
			uri: '^[0-9]+$',
			title: 'Number',
			template: 'Number match!',
		});

		spa.Page.add({
			uri: '^(?<name>[a-z]+)/(?<id> [0-9]+)',
			title: 'User Info',
			template: spa.includeTemplate('/pages/user.html'),
			init: function(){
				// this.context = this.res;
				this.renderTemplate(this.REQ.re);
			}
		});

		//catch all route
		// spa.Page.add({
		// 	uri: '^server/(?<fileName>.+)',
		// 	init: function (page, callback) {
		// 		spa.cache.$main.load(window.location.pathname);
		// 	}
		// });

		/*
			components
		*/

		spa.Component.add({
			name: 'clock',
			template: '<div id="spa-clock-text">The Time Is:</div><div id="spa-clock-time">{{hour}}:{{minute}}:{{second}}</div>',
			init: function(){
				console.log(this.setInterval)
				this.setInterval( 'refresh', function(component){
					var time = new Date();
					
					component.renderTemplate({
						hour: time.getHours()%12 || 12,
						minute: time.getMinutes(),
						second: time.getSeconds()
					});

				}, 500, this);
			}
		});

		spa.Component.add({
			name: 'reddit',
			template: spa.includeTemplate('/components/reddit.html'),
			init: function(){
				var component = this;
				$.get('https://www.reddit.com/.json', function (data) {
					component.renderTemplate({
						posts: data.data.children
					});
			    });
			}
		});

	</script>
</head>
<body>
	<div id="spa-loader-holder">
		<center>
			<h1>Loading...</h1>
		</center>
	</div>
	<div id="spa-shell" style="display:none;">
	</div>
</body>
</html>
