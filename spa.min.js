var spa=spa||{};
(function(a){jQuery.holdReady(!0);spa=jQuery.extend({buildTaskCount:0,$cache:{},routes:[],current:{},defualts:{shell:"index"}},spa);spa.inits=[];spa.init=function(b){spa.inits.push(b)};spa.onInit=function(){spa.inits.forEach(function(b){b()})};spa.includeScript=function(b){jQuery.ajax({url:b,dataType:"script",async:!1})};spa.includeTemplate=function(b){var a="";jQuery.ajax({url:b,success:function(b){a=b},async:!1});return a};spa.Mixer=function(){for(var b=[].slice.apply(arguments),c={create:function(d){for(var e=
{},f=0;f<b.length;f++)e=a.extend(e,b[f].create());e=a.extend(Object.create(e),c);return a.extend(Object.create(e),d||{})},__cleanUp:function(){for(var a=0;a<b.length;a++)b[a].__cleanUp&&b[a].__cleanUp.call(this)}},d={},e=0;e<b.length;e++)d=a.extend(Object.create(d),b[e]);return a.extend(Object.create(d),c)};spa.StyleSheets=function(){var b=Object.create(Array.prototype);b.create=function(){var b=[].slice.apply(arguments),d=jQuery("body");d.length&&(b.unshift(d),b=this.load.apply(this,b));return a.extend(Object.create(this),
b)};b.push=function(){var b=[].slice.apply(arguments),a=jQuery("body");a.length&&(b.unshift(a),b=this.load.apply(this,b));return Array.prototype.push.apply(this,b)};b.unload=function(b){return 0===jQuery("body ."+b).length?(b=jQuery("body style."+b),b.remove(),b=this.indexOf(b[0]),0!==~b&&this.splice(b,1),!0):!1};b.load=function(b){var a,c=[].slice.apply(arguments);c.shift();for(var f=c.length,g=0;g<f;g++)a=c[g],0===b.children('style[class="'+a.attr("class")+'"]').length?b.append(c[g]):(c.splice(g,
1),f--,g--);return c};return b}()})(jQuery);
spa.EventBase=function(){var a={__topics:{},create:function(b){return $.extend(Object.create(a),b||{})},init:function(){},subscribe:function(b,a){var c,e=[];$.isArray(b)||(b=[b]);for(var f=b.length;f--;)c=b[f],~e.indexOf(c)||(Object.hasOwnProperty.call(this.__topics,c)||(this.__topics[c]=[]),this.__topics[c].push(a),e.push(c))},publish:function(b,a){!this.__topics[b]||1>this.__topics[b].length||this.__topics[b].forEach(function(c){setTimeout(function(b,a){c(b||{},a)},0,a,b)})}};return a}();
spa.RenderBase=function(){return{errorTemplates:{},create:function(a){return $.extend(Object.create(this),{setTimeoutMap:{},setIntervalMap:{},$container:jQuery({}),context:{},template:"",cssRules:""},a||{})},__setUp:function(a){this.$container=a;this.$container.addClass(this.name);this.init()},__parse_style:function(){var a=jQuery('<style class="'+this.name+'-style">');a.append(this.cssRules||"");this.sheet=spa.$cache.$styleSheets.push(a)},__cleanUp:function(){this.__clearSets();this.$container.removeClass(this.name);
spa.$cache.$styleSheets.unload(this.$container.attr("class")+"-style")},on:function(a,b,c){return this.$container.on.apply(this.$container,arguments)},trigger:function(a,b,c){return this.$container.trigger.apply(this.$container,arguments)},setTimeout:function(a,b,c,d){this.setTimeoutMap[a]=window.setTimeout.apply(window,Array.apply(this,arguments).splice(1));return this.setTimeoutMap[a]},setInterval:function(a,b,c,d){this.setIntervalMap[a]=window.setInterval.apply(window,Array.apply(this,arguments).splice(1));
return this.setIntervalMap[a]},__clearSets:function(){for(var a in this.setIntervalMap)clearInterval(this.setIntervalMap[a]);for(a in this.setTimeoutMap)clearTimeout(this.setTimeoutMap[a])},init:function(){this.renderTemplate()},renderTemplate:function(a,b){this.sheet||this.__parse_style();this.$container.html(Mustache.render(this.template,jQuery.extend({},this.context,a||{}),jQuery.extend({},this.templateMap,b||{})));this.components=this.$find(this.$container)},$find:function(a,b){var c=[];a.find("[data-component-name]").each(function(b,
a){var d,e=jQuery(a);d=e.data("component-name");var h=spa.components[d];d=h?e.parents('[data-component-name="'+d+'"]').length?spa.Component.errorTemplates["500"].create({context:{name:d}}):h():spa.Component.errorTemplates["404"].create({context:{name:d}});c.push(d);d.__setUp(e)});return c},$insert:function(a,b){var c;c=a.data("component-name");var d=spa.components[c];c=d?a.parents('[data-component-name="'+c+'"]').length?spa.Component.errorTemplates["500"].create({context:{name:c}}):d(b||{}):spa.Component.errorTemplates["404"].create({context:{name:c}});
this.components.push(c);c.__setUp(a);return c}}}();spa.services={};spa.Service=function(){var a=Object.create(spa.EventBase);a.add=function(b){if(!b.name)return!1;b=this.create(b);b.init();spa.services[b.name]=b};return a}();spa.models={};spa.Model=function(){var a=Object.create(spa.EventBase);a.add=function(b){if(!b.name)return!1;b=this.create(b);spa.models[b.name]=b;b.init()};return a}();
spa.RenderBase.errorTemplates["404"]=spa.RenderBase.create({title:"404",template:"<center><h1><i>Page {{name}} Not Found</i></h1>{{message}}<center>",create:function(a){a.template=a.template||this.template;return spa.RenderBase.create(a)}});spa.RenderBase.errorTemplates["500"]=spa.RenderBase.create({title:"500",template:"<center><h1><i>SPA error {{name}}</i></h1>{{message}}<center>",create:function(a){a.template=a.template||this.template;return spa.RenderBase.create(a)}});spa.shells={};
spa.Shell=function(){var a=Object.create(spa.RenderBase);a.defaultContainerSelector="#spa-shell";a.add=function(b){if(!b.name)return!1;b=this.create(b);spa.shells[b.name]=b};a.renderTemplate=function(b,a){spa.RenderBase.renderTemplate.call(this,b)};a.update=function(b){b=b||spa.shells[spa.defaults.shell];if(spa.current.shell===b)return!1;spa.current.shell&&spa.current.shell.unload();spa.current.shell=b;b.__setUp(this.$container)};a.unload=function(){this.__cleanUp();(this.components?this.components:
[]).forEach(function(b){a.unload.call(b)}.bind(this))};a.create=function(b){return spa.RenderBase.create.call(this,b)};return a}();spa.components={};spa.Component=function(){var a=Object.create(spa.RenderBase);a.add=function(b){if(!b.name)return!1;spa.components[b.name]=function(a){a=a?$.extend(Object.create(b),a):b;return this.create(a)}.bind(this)};a.create=function(b){return spa.RenderBase.create.call(this,b)};return a}();
spa.Form=function(){var a=Object.create(spa.RenderBase);a.errorMessageClass="input-error-message";a.add=function(b){if(!b.name)return!1;spa.components[b.name]=function(a){a=a?$.extend(Object.create(b),a):b;return this.create(a)}.bind(this)};a.renderErrors=function(b){var a=this;a.$container.find("."+a.errorMessageClass).remove();jQuery.each(b,function(b,c){if(Object.hasOwnProperty.call(a,"set"+b+"Error"))a["set"+b+"Error"](b,c);else a.setError(b,c)})};a.setError=function(b,a){var c=this,e=this.getErrorTarget(b);
a.prototype!==Array.prototype&&(a=[a]);jQuery.each(a,function(a,b){e.append('<span class="'+c.errorMessageClass+'">'+b+"</span>")})};a.getErrorTarget=function(a){return this.$container.find('[for="'+a+'"]')};a.create=function(a){return spa.RenderBase.create.call(this,a)};return a}();spa.routes=[];
spa.Router={defaultRoute:spa.routes,add:function(a){if($.isArray(a))a.forEach(this.add);else{if(!a.uri&&!a.init)return!1;spa.routes.push(a);return!0}},lookup:function(a,b){var c=!1;a=a.replace(/^\/+/,"");b=b||this.defaultRoute;b.some(function(b){var d=XRegExp.exec(a,XRegExp(b.uri,"ix"));if(d)return b.REQ={url:a,re:d},c=b,!0});return c},resolver:function(a,b){b=void 0===b?!0:b;var c=this.lookup(a);c||(c=spa.RenderBase.errorTemplates["404"],c.context={name:a});c.init();spa.Shell.update(c.shell);b&&
spa.Router.historyAdd({url:a},c.title,a)},historyAdd:function(a,b,c){window.history.pushState(a,b,c)}};
spa.init(function(){spa.$cache.$styleSheets=spa.StyleSheets.create();spa.EventBase.subscribe("__dom-content-loaded-start",function(){spa.$cache.$loader=jQuery("#spa-loader-holder");spa.$cache.$body=jQuery("body");var a=[].slice.call(spa.$cache.$styleSheets);a.length&&(a.unshift(jQuery("head")),spa.$cache.$styleSheets.load.apply({},a));spa.Shell.$container=jQuery(spa.Shell.defaultContainerSelector);jQuery(window).on("popstate",function(a){spa.EventBase.publish("load-shell",{path:window.location.pathname,
isHistory:!1})});spa.$cache.$body.on("click",".ajax-link",function(a){a.preventDefault();spa.EventBase.publish("load-shell",{path:jQuery(this).attr("href"),isHistory:!0});return!1})});spa.EventBase.subscribe("__spa-ready",function(){jQuery.holdReady(!1);spa.EventBase.publish("load-shell",{path:window.location.pathname,isHistory:!1})});spa.EventBase.subscribe("load-shell",function(a){spa.Router.resolver(a.path,a.isHistory);spa.$cache.$loader.hide();spa.Shell.$container.show()});(function(){var a=spa.buildTaskCount;
spa.EventBase.subscribe("__dom-content-loaded-end",function(b){0===a&&spa.EventBase.publish("__spa-ready");a--});spa.EventBase.subscribe("spa-build-task-complete",function(b){0===a&&spa.EventBase.publish("__spa-ready");a--})})()});jQuery(document).on("DOMContentLoaded",function(a){spa.EventBase.publish("__dom-content-loaded-start");spa.EventBase.publish("__dom-content-loaded-end")});
