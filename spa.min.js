var spa=spa||{};(function(b){jQuery.holdReady(!0);jQuery.extend(spa,{buildTaskCount:0,$cache:{},routes:[],current:{},defualts:{shell:"index"}});spa.inits=[];spa.init=function(a){spa.inits.push(a)};spa.onInit=function(){spa.inits.forEach(function(a){a()})};spa.includeScript=function(a){jQuery.ajax({url:a,dataType:"script",async:!1})};spa.includeTemplate=function(a){var b="";jQuery.ajax({url:a,success:function(a){b=a},async:!1});return b}})(jQuery);
spa.EventBase=function(){var b={setTimeoutMap:{},setIntervalMap:{},listeners:{}};b.$container=jQuery({});b.on=function(a,b,d){return this.$container.on.apply(this.$container,arguments)};b.trigger=function(a,b,d){return this.$container.trigger.apply(this.$container,arguments)};b.setTimeOut=function(a,b,d,e){this.setTimeoutMap[a]=window.setTimeOut.apply(window,Array.apply(this,arguments).splice(1));return this.setTimeoutMap[a]};b.setInterval=function(a,b,d,e){this.setIntervalMap[a]=window.setInterval.apply(window,
Array.apply(this,arguments).splice(1));return this.setIntervalMap[a]};b.__clearSets=function(){for(var a in this.setIntervalMap)clearInterval(this.setIntervalMap[a]);for(a in this.setTimeoutMap)clearTimeout(this.setTimeoutMap[a])};b.unload=function(){this.__clearSets()};b.__declare=function(a){var b=Object.create(this);return jQuery.extend(b,a)};b.__topics={};b.subscribe=function(a,b){var d,e=[];$.isArray(a)||(a=[a]);for(var g=a.length;g--;)d=a[g],~e.indexOf(d)&&(Object.hasOwnProperty(this.__topics,
d)||(this.__topics[d]=[]),this.__topics[d].push(b),e.push(d))};b.publish=function(a,b){!this.__topics[a]||1>this.__topics[a].length||this.__topics[a].forEach(function(a){this.setTimeout(function(b){a(b||{})},0,b)})};return b}();
spa.RenderBase=function(){var b=Object.create(spa.EventBase);b.context={};b.template="";b.errorTemplates={};b.__setUp=function(a){this.$container=a;this.$container.addClass(this.name);this.init()};b.init=function(){this.renderTemplate()};b.renderTemplate=function(a){this.$container.html(Mustache.render(this.template,jQuery.extend({},this.context,a)));this.components=this.$find(this.$container)};b.$find=function(a,b){var d=[];a.find("[data-component-name]").each(function(a,b){var c=jQuery(b),h=c.data("component-name"),
f=spa.components[h];f?d.push(f):(f=spa.Component.errorTemplates["404"],f.context={name:h});f.__setUp(c)});return d};return b}();spa.services={};spa.Service=function(){var b=Object.create(spa.EventBase);b.add=function(a){if(!a.name)return!1;a=this.__declare(a);spa.services[a.name]=a};return b}();spa.models={};spa.Model=function(){var b=Object.create(spa.EventBase);b.add=function(a){if(!a.name)return!1;a=this.__declare(a);spa.models[a.name]=a;a.init()};return b}();
spa.RenderBase.errorTemplates["404"]=spa.RenderBase.__declare({template:"<center><h1><i>Page {{name}} Not Found</i></h1>{{message}}<center>",title:"404"});spa.RenderBase.errorTemplates["500"]=spa.RenderBase.__declare({title:"500",template:"<center><h1><i>SPA error {{name}}</i></h1>{{message}}<center>"});spa.shells={};
spa.Shell=function(){var b=Object.create(spa.RenderBase);b.defualtContainerSelector="#spa-shell";b.add=function(a){if(!a.name)return!1;a=this.__declare(a);spa.shells[a.name]=a};b.renderTemplate=function(a,b){spa.RenderBase.renderTemplate.call(this,a)};b.update=function(a){a=a||spa.shells[spa.defualts.shell];if(spa.current.shell===a)return!1;spa.current.shell=a;a.__setUp(this.$container)};return b}();spa.components={};
spa.Component=function(){var b=Object.create(spa.RenderBase);b.add=function(a){if(!a.name)return!1;a=this.__declare(a);spa.components[a.name]=a};return b}();spa.routes=[];
spa.Router={defaultRoute:spa.routes,add:function(b){if($.isArray(b))b.forEach(this.add);else{if(!b.uri&&!b.init)return!1;spa.routes.push(b);return!0}},lookup:function(b,a){var c=!1;b=b.replace(/^\/+/,"");a=a||this.defaultRoute;a.some(function(a){var e=XRegExp.exec(b,XRegExp(a.uri,"ix"));if(e)return a.REQ={url:b,re:e},c=a,!0});return c},resolver:function(b,a){a=void 0===a?!0:!1;var c=this.lookup(b);c||(c=spa.RenderBase.errorTemplates["404"],c.context={name:b});spa.Shell.update(c.shell);c.init();a&&
spa.Router.historyAdd({url:b},c.title,b)},historyAdd:function(b,a,c){window.history.pushState(b,a,c)}};
spa.init(function(){spa.EventBase.subscribe("__dom-content-loaded-start",function(){spa.$cache.$loader=jQuery("#spa-loader-holder");spa.$cache.$body=jQuery("body");spa.Shell.$container=jQuery(spa.Shell.defualtContainerSelector);jQuery(window).on("popstate",function(b){spa.EventBase.publish("load-shell",{path:window.location.pathname,isHistory:!1})});spa.$cache.$body.on("click",".ajax-link",function(b){b.preventDefault();spa.EventBase.publish("load-shell",{path:jQuery(this).attr("href"),isHistory:!0});
return!1})});spa.EventBase.subscribe("__spa-ready",function(){spa.EventBase.publish("load-shell",{path:window.location.pathname,isHistory:!1})});spa.EventBase.subscribe("load-shell",function(b){spa.Router.resolver(b.path,b.isHistory);spa.$cache.$loader.hide();spa.Shell.$container.show()});(function(){var b=spa.buildTaskCount;spa.EventBase.subscribe("__dom-content-loaded-end",function(a){0===b&&spa.EventBase.publish("__spa-ready")});spa.EventBase.subscribe("spa-build-task-complete",function(a){b--;
0===b&&spa.EventBase.publish("__spa-ready")})})()});spa.onInit();jQuery(document).on("DOMContentLoaded",function(b){spa.EventBase.publish("___dom-content-loaded-start");spa.EventBase.publish("___dom-content-loaded-end")});
