var spa=spa||{};(function(a){jQuery.holdReady(!0);spa=jQuery.extend({buildTaskCount:0,$cache:{},routes:[],current:{},defualts:{shell:"index"}},spa);spa.inits=[];spa.init=function(b){spa.inits.push(b)};spa.onInit=function(){spa.inits.forEach(function(b){b()})};spa.includeScript=function(b){jQuery.ajax({url:b,dataType:"script",async:!1})};spa.includeTemplate=function(b){var a="";jQuery.ajax({url:b,success:function(b){a=b},async:!1});return a}})(jQuery);
spa.EventBase=function(){var a={setTimeoutMap:{},setIntervalMap:{},listeners:{}};a.$container=jQuery({});a.on=function(b,a,c){return this.$container.on.apply(this.$container,arguments)};a.trigger=function(b,a,c){return this.$container.trigger.apply(this.$container,arguments)};a.setTimeout=function(b,a,c,e){this.setTimeoutMap[b]=window.setTimeout.apply(window,Array.apply(this,arguments).splice(1));return this.setTimeoutMap[b]};a.setInterval=function(b,a,c,e){this.setIntervalMap[b]=window.setInterval.apply(window,
Array.apply(this,arguments).splice(1));return this.setIntervalMap[b]};a.__clearSets=function(){for(var b in this.setIntervalMap)clearInterval(this.setIntervalMap[b]);for(b in this.setTimeoutMap)clearTimeout(this.setTimeoutMap[b])};a.unload=function(){this.__clearSets()};a.__declare=function(b){var a=Object.create(this);return jQuery.extend(a,b)};a.init=function(){};a.__topics={};a.subscribe=function(b,a){var c,e=[];$.isArray(b)||(b=[b]);for(var g=b.length;g--;)c=b[g],~e.indexOf(c)||(Object.hasOwnProperty.call(this.__topics,
c)||(this.__topics[c]=[]),this.__topics[c].push(a),e.push(c))};a.publish=function(b,a){!this.__topics[b]||1>this.__topics[b].length||this.__topics[b].forEach(function(b){setTimeout(function(a){b(a||{})},0,a)})};return a}();
spa.RenderBase=function(){var a=Object.create(spa.EventBase);a.context={};a.template="";a.errorTemplates={};a.__setUp=function(b){this.$container=b;this.$container.addClass(this.name);this.init()};a.init=function(){this.renderTemplate()};a.renderTemplate=function(b){this.$container.html(Mustache.render(this.template,jQuery.extend({},this.context,b)));this.components=this.$find(this.$container)};a.$find=function(b,a){var c=[];b.find("[data-component-name]").each(function(b,a){var d=jQuery(a),h=d.data("component-name"),
f=spa.components[h];f?c.push(f):(f=spa.Component.errorTemplates["404"],f.context={name:h});f.__setUp(d)});return c};return a}();spa.services={};spa.Service=function(){var a=Object.create(spa.EventBase);a.add=function(b){if(!b.name)return!1;b=this.__declare(b);spa.services[b.name]=b};return a}();spa.models={};spa.Model=function(){var a=Object.create(spa.EventBase);a.add=function(b){if(!b.name)return!1;b=this.__declare(b);spa.models[b.name]=b;b.init()};return a}();
spa.RenderBase.errorTemplates["404"]=spa.RenderBase.__declare({template:"<center><h1><i>Page {{name}} Not Found</i></h1>{{message}}<center>",title:"404"});spa.RenderBase.errorTemplates["500"]=spa.RenderBase.__declare({title:"500",template:"<center><h1><i>SPA error {{name}}</i></h1>{{message}}<center>"});spa.shells={};
spa.Shell=function(){var a=Object.create(spa.RenderBase);a.defaultContainerSelector="#spa-shell";a.add=function(b){if(!b.name)return!1;b=this.__declare(b);spa.shells[b.name]=b};a.renderTemplate=function(b,a){spa.RenderBase.renderTemplate.call(this,b)};a.update=function(b){b=b||spa.shells[spa.defaults.shell];if(spa.current.shell===b)return!1;spa.current.shell=b;b.__setUp(this.$container)};return a}();spa.components={};
spa.Component=function(){var a=Object.create(spa.RenderBase);a.add=function(b){if(!b.name)return!1;b=this.__declare(b);spa.components[b.name]=b};return a}();
spa.Form=function(){var a=Object.create(spa.Component);a.renderErrors=function(b){jQuery.each(b,function(b,c){a.setError(b,c)})};a.setError=function(b,a){var c=this.getErrorTarget(b);a.prototype!==Array.prototype&&(a=[a]);jQuery.each(a,function(a,b){c.append("<span>"+b+"</span>")})};a.getErrorTarget=function(a){return this.$container.find('[for="'+a+'"]')};return a}();spa.routes=[];
spa.Router={defaultRoute:spa.routes,add:function(a){if($.isArray(a))a.forEach(this.add);else{if(!a.uri&&!a.init)return!1;spa.routes.push(a);return!0}},lookup:function(a,b){var d=!1;a=a.replace(/^\/+/,"");b=b||this.defaultRoute;b.some(function(b){var e=XRegExp.exec(a,XRegExp(b.uri,"ix"));if(e)return b.REQ={url:a,re:e},d=b,!0});return d},resolver:function(a,b){b=void 0===b?!0:b;var d=this.lookup(a);d||(d=spa.RenderBase.errorTemplates["404"],d.context={name:a});spa.Shell.update(d.shell);d.init();b&&
spa.Router.historyAdd({url:a},d.title,a)},historyAdd:function(a,b,d){window.history.pushState(a,b,d)}};
spa.init(function(){spa.EventBase.subscribe("__dom-content-loaded-start",function(){spa.$cache.$loader=jQuery("#spa-loader-holder");spa.$cache.$body=jQuery("body");spa.Shell.$container=jQuery(spa.Shell.defaultContainerSelector);jQuery(window).on("popstate",function(a){spa.EventBase.publish("load-shell",{path:window.location.pathname,isHistory:!1})});spa.$cache.$body.on("click",".ajax-link",function(a){a.preventDefault();spa.EventBase.publish("load-shell",{path:jQuery(this).attr("href"),isHistory:!0});
return!1})});spa.EventBase.subscribe("__spa-ready",function(){jQuery.holdReady(!1);spa.EventBase.publish("load-shell",{path:window.location.pathname,isHistory:!1})});spa.EventBase.subscribe("load-shell",function(a){spa.Router.resolver(a.path,a.isHistory);spa.$cache.$loader.hide();spa.Shell.$container.show()});(function(){var a=spa.buildTaskCount;spa.EventBase.subscribe("__dom-content-loaded-end",function(b){0===a&&spa.EventBase.publish("__spa-ready")});spa.EventBase.subscribe("spa-build-task-complete",
function(b){a--;0===a&&spa.EventBase.publish("__spa-ready")})})()});jQuery(document).on("DOMContentLoaded",function(a){spa.EventBase.publish("__dom-content-loaded-start");spa.EventBase.publish("__dom-content-loaded-end")});
