var spa={};(function(b){jQuery.holdReady(!0);spa={$cache:{},routes:[],current:{},components:{},defualts:{shell:"index"},includeScript:function(a){jQuery.ajax({url:a,dataType:"script",async:!1})},includeTemplate:function(a){var b="";jQuery.ajax({url:a,success:function(a){b=a},async:!1});return b}}})(jQuery);
spa.__EventBase=function(){var b={setTimeoutMap:{},setIntervalMap:{},listeners:{}};b.$container=jQuery({});b.on=function(a,b,c){return this.$container.on.apply(this,arguments)};b.triger=function(a,b,c){return this.$container.triger.apply(this,arguments)};b.setTimeOut=function(a,b,c,f){this.setTimeoutMap[a]=window.setTimeOut.apply(window,Array.apply(this,arguments).splice(1));return this.setTimeoutMap[a]};b.setInterval=function(a,b,c,f){this.setIntervalMap[a]=window.setInterval.apply(window,Array.apply(this,
arguments).splice(1));return this.setIntervalMap[a]};b.__clearSets=function(){for(var a in this.setIntervalMap)clearInterval(this.setIntervalMap[a]);for(a in this.setTimeoutMap)clearTimeout(this.setTimeoutMap[a])};b.unload=function(){this.__clearSets()};b.__declare=function(a){var b=Object.create(this);return jQuery.extend(b,{__declare:null},a)};return b}();
spa.__RenderBase=function(){var b=Object.create(spa.__EventBase);b.context={};b.template="";b.errorTemplates={};b.__setUp=function(a){this.$container=a;this.init()};b.init=function(){this.renderTemplate()};b.renderTemplate=function(a){this.$container.html(Mustache.render(this.template,jQuery.extend({},this.context,a)));this.components=spa.Component.$find(this.$container)};return b}();
spa.__RenderBase.errorTemplates["404"]=spa.__RenderBase.__declare({template:"<center><h1><i>Page {{name}} Not Found</i></h1>{{message}}<center>",title:"404"});spa.__RenderBase.errorTemplates["500"]=spa.__RenderBase.__declare({title:"500",template:"<center><h1><i>SPA error {{name}}</i></h1>{{message}}<center>"});spa.shells={};
spa.Shell=function(){var b=Object.create(spa.__RenderBase);b.defualtContainerSelector="#spa-shell";b.add=function(a){if(!a.name)return!1;a=this.__declare(a);spa.shells[a.name]=a};b.renderTemplate=function(a,b){spa.__RenderBase.renderTemplate.call(this,a)};b.update=function(a){a=a||spa.shells[spa.defualts.shell];if(spa.current.shell===a)return!1;spa.current.shell=a;a.__setUp(this.$container)};return b}();spa.pages=[];
spa.Page=function(){var b=Object.create(spa.__RenderBase);b.add=function(a){if(!a.uri)return!1;a=this.__declare(a);spa.pages.push(a)};b.renderTemplate=function(a,b){spa.__RenderBase.renderTemplate.call(this,a);document.title=this.title||document.title};b.resolver=function(a,b){b=void 0===b?!0:!1;var c=spa.Router.lookup(a,spa.pages);if(c===spa.current.page)return!1;c||(c=this.errorTemplates["404"],c.context={name:a});spa.current.page&&spa.current.page.unload();spa.Shell.update(c.shell);c.__setUp(spa.current.shell.$container.find("#spa-shell-page"));
spa.current.page=c;b&&spa.Router.historyAdd({url:a},c.title,a)};return b}();spa.components={};spa.Component=function(){var b=Object.create(spa.__RenderBase);b.add=function(a){if(!a.name)return!1;a=this.__declare(a);spa.components[a.name]=a};b.$find=function(a,b){var c=[];a.find("[data-component-name]").each(function(a){a=jQuery(this);var b=a.data("component-name"),d=spa.components[b];d?c.push(d):(d=spa.Component.errorTemplates["404"],d.context={name:b});d.__setUp(a)});return c};return b}();
spa.routes=[];spa.Router={defaultRoute:spa.pages,lookup:function(b,a){var e=!1;b=b.replace(/^\/+/,"");a=a||this.defaultRoute;a.some(function(a){var f=XRegExp.exec(b,XRegExp(a.uri,"ix"));if(f)return a.REQ={url:b,re:f},e=a,!0});return e},historyAdd:function(b,a,e){window.history.pushState(b,a,e)}};
jQuery(document).on("DOMContentLoaded",function(b){spa.$cache.$loader=jQuery("#spa-loader-holder");spa.$cache.$body=jQuery("body");spa.Shell.$container=jQuery(spa.Shell.defualtContainerSelector);jQuery(window).on("popstate",function(a){spa.Page.resolver(window.location.pathname,!1)});spa.Page.resolver(window.location.pathname,!1);spa.$cache.$loader.hide();spa.Shell.$container.show();spa.$cache.$body.on("click",".ajax-link",function(a){a.preventDefault();spa.Page.resolver(jQuery(this).attr("href"));
return!1})});
